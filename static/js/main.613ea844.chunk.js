(this.webpackJsonpsim=this.webpackJsonpsim||[]).push([[0],{41:function(r,e,t){},49:function(r,e,t){"use strict";t.r(e);var a=t(2),n=t(0),o=t.n(n),c=t(9),d=t.n(c),s=t(32),i=t(64),f=(t(41),t(3)),l=t(27),u=t(33),b=t(5),m=t(66),g={offsetBottom:function(r,e){return N(e,r.first)},offsetTop:function(r,e){return N(e,r.last)},halfRoadLeft:function(r,e){return I(e.roadWidth/2,r.angle-90)},halfRoadRight:function(r,e){return I(e.roadWidth/2,r.angle+90)},laneBottomLeft:function(r,e,t){return N(g.halfRoadLeft(e,t),g.offsetBottom(r,t))},laneTopLeft:function(r,e,t){return N(g.halfRoadLeft(e,t),g.offsetTop(r,t))},laneBottomRight:function(r,e,t){return N(g.halfRoadRight(e,t),g.offsetBottom(r,t))},laneTopRight:function(r,e,t){return N(g.halfRoadRight(e,t),g.offsetTop(r,t))},roadBottomLeft:function(r,e){return N(N(r.forward[0].first,e),g.halfRoadLeft(r,e))},roadBottomRight:function(r,e){return N(N(r.backward[r.backward.length-1].first,e),g.halfRoadRight(r,e))},roadTopLeft:function(r,e){return N(N(r.forward[0].last,e),g.halfRoadLeft(r,e))},roadTopRight:function(r,e){return N(N(r.backward[r.backward.length-1].last,e),g.halfRoadRight(r,e))},roadTopMiddle:function(r,e){return N(I(e.roadLength,r.angle),N(I((r.numberOfForward+r.numberOfBackward)*e.roadWidth/2,r.angle+90),g.roadBottomLeft(r,e)))}};function h(r){if(!r||!r.length)return null;var e,t="",a=Object(b.a)(r);try{for(a.s();!(e=a.n()).done;){var n=e.value;if(t+=n.letter+" ",n.coords){var o,c=Object(b.a)(n.coords);try{for(c.s();!(o=c.n()).done;){var d=o.value;t+=d.x+" "+d.y+" "}}catch(s){c.e(s)}finally{c.f()}}}}catch(s){a.e(s)}finally{a.f()}return t}function j(r){var e=r.accept,t=r.onDrop,n=r.indexRoad,o=r.children,c=r.side,d=Object(m.a)({accept:e,drop:function(r){return t(r,n,c)}}),s=Object(f.a)(d,2)[1];return Object(a.jsx)("g",{ref:s,children:o})}function v(r){var e=r.string,t=r.side,n=r.indexLane,o=r.indexRoad,c=r.accept,d=r.onDrop,s=Object(m.a)({accept:c,drop:function(r){return d(r,o,t,n)}}),i=Object(f.a)(s,2)[1];return Object(a.jsx)("path",{ref:i,d:e,className:t+"-asphalt"},n)}function p(r){var e=r.points,t=r.coordInfo,n=r.disabled;if(!e||!t||void 0!==n&&n)return null;for(var o={strings:{forward:[],backward:[]},elements:{}},c=function(){var r,n=s[d],c=Object(b.a)(e);try{for(c.s();!(r=c.n()).done;){var i,f=r.value,l=Object(b.a)(f[n]);try{for(l.s();!(i=l.n()).done;){var u=i.value;o.strings[n].push([g.offsetBottom(u,t),g.offsetTop(u,t)])}}catch(m){l.e(m)}finally{l.f()}}}catch(m){c.e(m)}finally{c.f()}o.elements[n]=o.strings[n].map((function(r,e){return Object(a.jsx)("line",{x1:r[0].x,y1:r[0].y,x2:r[1].x,y2:r[1].y,className:n+"-debug"},e)}))},d=0,s=["backward","forward"];d<s.length;d++)c();return Object(a.jsxs)("g",{children:[o.elements.forward,o.elements.backward]})}function O(r){var e=r.points,t=r.coordInfo,n=r.disabled;if(!e||!t||void 0!==n&&n)return null;for(var o={elements:{},strings:{continous:[],striped:[]}},c=0,d=["backward","forward"];c<d.length;c++){var s,i=d[c],l=Object(b.a)(e);try{for(l.s();!(s=l.n()).done;){var u,m=s.value,h=Object(b.a)(m[i].entries());try{for(h.s();!(u=h.n()).done;){var j=Object(f.a)(u.value,2),v=j[0],p=j[1];v===m[i].length-1&&"forward"!==i||(v===m[i].length-1&&"forward"===i?o.strings.continous.push([g.laneBottomRight(p,m,t),g.laneTopRight(p,m,t)]):o.strings.striped.push([g.laneBottomRight(p,m,t),g.laneTopRight(p,m,t)]))}}catch(O){h.e(O)}finally{h.f()}}}catch(O){l.e(O)}finally{l.f()}}return o.elements.continous=o.strings.continous.map((function(r,e){return Object(a.jsx)("line",{x1:r[0].x,y1:r[0].y,x2:r[1].x,y2:r[1].y,className:"line"},e)})),o.elements.striped=o.strings.striped.map((function(r,e){return Object(a.jsx)("line",{x1:r[0].x,y1:r[0].y,x2:r[1].x,y2:r[1].y,className:"line",strokeDasharray:"30, 60"},e)})),Object(a.jsxs)("g",{children:[o.elements.continous,o.elements.striped]})}function w(r){var e=r.points,t=r.coordInfo,n=r.rotateBind,o=r.disabled;if(!(e&&t&&n)||void 0!==o&&o)return null;var c,d={strings:[]},s=Object(b.a)(e);try{for(s.s();!(c=s.n()).done;){var i=c.value;d.strings.push({vectors:g.roadTopMiddle(i,t),order:i.order})}}catch(f){s.e(f)}finally{s.f()}return d.elements=d.strings.map((function(r,e){return Object(a.jsx)("circle",Object(u.a)({cx:r.vectors.x,cy:r.vectors.y,r:"10",className:"rotate"},n(r.order)),e)})),Object(a.jsx)("g",{children:d.elements})}function x(r){var e=r.points,t=r.coordInfo,n=r.addLanes,o=r.disabled;if(!e||!t||void 0!==o&&o)return null;var c,d={strings:{forward:{remove:[],add:[]},backward:{remove:[],add:[]}},elements:{forward:{remove:[],add:[]},backward:{remove:[],add:[]}}},s=Object(b.a)(e);try{for(s.s();!(c=s.n()).done;){var i=c.value;d.strings.forward.remove.push(N(g.roadBottomLeft(i,t),I(t.roadLength/3,i.angle))),d.strings.forward.add.push(N(g.roadBottomLeft(i,t),I(2*t.roadLength/3,i.angle))),d.strings.backward.remove.push(N(g.roadBottomRight(i,t),I(t.roadLength/3,i.angle))),d.strings.backward.add.push(N(g.roadBottomRight(i,t),I(2*t.roadLength/3,i.angle)))}}catch(f){s.e(f)}finally{s.f()}return d.elements.forward.remove=d.strings.forward.remove.map((function(r,e){return Object(a.jsx)("circle",{cx:r.x,cy:r.y,r:"10",className:"add-lane",onClick:function(){return n(e,"Forward",-1)}},e)})),d.elements.forward.add=d.strings.forward.add.map((function(r,e){return Object(a.jsx)("circle",{cx:r.x,cy:r.y,r:"10",className:"add-lane",onClick:function(){return n(e,"Forward",1)}},e)})),d.elements.backward.remove=d.strings.backward.remove.map((function(r,e){return Object(a.jsx)("circle",{cx:r.x,cy:r.y,r:"10",className:"add-lane",onClick:function(){return n(e,"Backward",-1)}},e)})),d.elements.backward.add=d.strings.backward.add.map((function(r,e){return Object(a.jsx)("circle",{cx:r.x,cy:r.y,r:"10",className:"add-lane",onClick:function(){return n(e,"Backward",1)}},e)})),Object(a.jsxs)("g",{children:[d.elements.forward.remove,d.elements.forward.add,d.elements.backward.remove,d.elements.backward.add]})}function y(r){var e=r.points,t=r.coordInfo,n=r.disabled;if(!e||!t||void 0!==n&&n)return null;var o={};o.string=h([{letter:"M",coords:[g.roadBottomLeft(e[0],t)]}]);var c,d=Object(b.a)(e);try{for(d.s();!(c=d.n()).done;){var s=c.value;o.string+=h([{letter:"L",coords:[g.roadBottomLeft(s,t),g.roadBottomRight(s,t)]}])}}catch(i){d.e(i)}finally{d.f()}return o.element=Object(a.jsx)("path",{d:o.string,className:"center"}),o.element}function k(r){var e=r.points,t=r.coordInfo,n=r.disabled;if(!e||!t||void 0!==n&&n)return null;var o={};o.string=h([{letter:"M",coords:[g.roadBottomLeft(e[0],t)]}]);var c,d=Object(b.a)(e.entries());try{for(d.s();!(c=d.n()).done;){var s=Object(f.a)(c.value,2),i=s[0],l=s[1];o.string+=h([{letter:"L",coords:[g.roadBottomLeft(l,t),g.roadTopLeft(l,t)]},{letter:"M",coords:[g.roadTopRight(l,t)]},{letter:"L",coords:[g.roadBottomRight(l,t)]}]),i===e.length-1&&(o.string+=h([{letter:"L",coords:[g.roadBottomLeft(e[0],t)]}]))}}catch(u){d.e(u)}finally{d.f()}return o.element=Object(a.jsx)("path",{d:o.string,className:"curb"}),o.element}function B(r,e){return Object(a.jsx)("text",{children:"Cars"})}var L=t(43);function R(){var r=Object(n.useRef)(),e=Object(n.useState)({}),t=Object(f.a)(e,2),o=t[0],c=t[1],d=Object(n.useState)([{numberOfBackward:1,numberOfForward:2,angle:0,order:0},{numberOfBackward:1,numberOfForward:1,angle:110,order:1},{numberOfBackward:2,numberOfForward:3,angle:170,order:2},{numberOfBackward:1,numberOfForward:1,angle:300,order:3}]),s=Object(f.a)(d,2),i=s[0],u=s[1],m=Object(l.a)((function(r){var e=r.event,t=Object(f.a)(r.args,1)[0];if(e.x&&e.y){var a=N(e,function(r,e){var t=r.x*e,a=r.y*e;return{x:t,y:a}}(o,-1)),n=Math.atan2(a.y,a.x)*(180/Math.PI);(n%=360)<0&&(n+=360);var c=L.cloneDeep(i);c.sort((function(r,e){return r.angle-e.angle}));for(var d=0;d<c.length;d++)t===c[d].order&&(c[d].angle=n);u(c)}}));Object(n.useEffect)((function(){function e(){var e=function(r,e){if(!r.current)return null;var t=r.current.getBoundingClientRect(),a=(t.right-t.left)/2,n=(t.bottom-t.top)/2,o=Math.max.apply(Math,e.map((function(r){return r.numberOfForward+r.numberOfBackward}))),c=Math.min(a,n);return{x:a,y:n,roadLength:c/2,roadWidth:c/o*.5,maxRoadWidth:o}}(r,i);c(e)}return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[r,i]);var R=function(r,e){var t=[];if(!(e&&e.roadLength&&e.roadWidth))return null;for(var a=0;a<r.length;a++){var n=r[a],o=(n.numberOfForward+n.numberOfBackward-1)*e.roadWidth/2;t[a]={forward:[],backward:[],maxDistance:o,angle:n.angle,order:n.order,numberOfForward:n.numberOfForward,numberOfBackward:n.numberOfBackward};for(var c=n.numberOfForward+n.numberOfBackward,d=(n.numberOfForward+n.numberOfBackward)*e.roadWidth/5,s=0;s<c;s++){var i=N(I(o-s*e.roadWidth,n.angle-90),N(I(e.maxRoadWidth*e.roadWidth,n.angle),I(d,n.angle-180))),f=N(i,I(e.roadLength,n.angle));s<n.numberOfForward?t[a].forward.push({first:i,last:f}):t[a].backward.push({first:i,last:f})}}return t}(i,o),T=Object(n.useState)([{backward:[],forward:[]},{backward:[],forward:[]},{backward:[],forward:[]},{backward:[],forward:[]}]),F=Object(f.a)(T,2),M=F[0],D=F[1];var W=function(r){var e=r.points,t=r.coordInfo,n=r.handleSignDrop,o=r.handleCarDrop,c=r.disabled;if(!e||!t||void 0!==c&&c)return null;var d,s={forward:[],backward:[]},i=Object(b.a)(e.entries());try{var l=function(){for(var r=Object(f.a)(d.value,2),e=r[0],c=r[1],i={forward:[],backward:[]},l=0,u=["backward","forward"];l<u.length;l++){var m,p=u[l],O=Object(b.a)(c[p]);try{for(O.s();!(m=O.n()).done;){var w=m.value;i[p].push(h([{letter:"M",coords:[g.offsetBottom(w,t)]},{letter:"L",coords:[g.laneBottomLeft(w,c,t),g.laneTopLeft(w,c,t),g.laneTopRight(w,c,t),g.laneBottomRight(w,c,t)]},{letter:"Z"}]))}}catch(B){O.e(B)}finally{O.f()}}for(var x=function(){var r=k[y];s[r].push(Object(a.jsx)(j,{indexRoad:e,accept:["sign"],side:r,onDrop:function(t){return n(t,e,r)},children:i[r].map((function(t,n){return Object(a.jsx)(v,{string:t,side:r,indexLane:n,indexRoad:e,accept:["car"],onDrop:function(t){return o(t,e,r,n)}},n)}))},e))},y=0,k=["backward","forward"];y<k.length;y++)x()};for(i.s();!(d=i.n()).done;)l()}catch(u){i.e(u)}finally{i.f()}return s}({points:R,coordInfo:o,handleSignDrop:function(r,e,t){if("forward"===t){var a=L.cloneDeep(M);a[e].signs||(a[e].signs=[]),a[e].signs.push(r.id),D(a)}},handleCarDrop:function(r,e,t,a){var n=L.cloneDeep(M);n[e][t][a]||(n[e][t][a]=[]),n[e][t][a].push(r.id),D(n)}});if(W)var C=W.backward,S=W.forward;return console.log(M),Object(a.jsx)("div",{style:{touchAction:"none"},children:Object(a.jsxs)("svg",{className:"artboard",ref:r,children:[Object(a.jsxs)("g",{children:[C,S]}),Object(a.jsx)(y,{points:R,coordInfo:o}),Object(a.jsx)(k,{points:R,coordInfo:o}),Object(a.jsx)(O,{points:R,coordInfo:o}),Object(a.jsx)(p,{points:R,coordInfo:o,disabled:!0}),Object(a.jsx)(w,{points:R,coordInfo:o,rotateBind:m}),Object(a.jsx)(x,{points:R,coordInfo:o,addLanes:function(r,e,t){var a=L.cloneDeep(i);(a[r]["numberOf"+e]>1||t>0)&&(a[r]["numberOf"+e]+=t),u(a)}}),Object(a.jsx)(B,{objectInfo:M,coordInfo:o})]})})}function I(r,e){var t=e*Math.PI/180;return{x:r*Math.cos(t),y:r*Math.sin(t)}}function N(r,e){return{x:r.x+e.x,y:r.y+e.y}}var T=t(65),F=t(67),M=t.p+"static/media/forward.fc55a6c4.svg",D=t.p+"static/media/give way.db0b54fd.svg",W=t.p+"static/media/left.1aa9e07d.svg",C=t.p+"static/media/right.ff8f1205.svg",S=t.p+"static/media/stop.4938481c.svg",E=t.p+"static/media/priority.1971fe2a.svg";function z(){var r=[M,D,W,C,S,E].map((function(r,e){return Object(a.jsx)(P,{src:r,index:e},e)}));return Object(a.jsxs)("div",{className:"inventory",children:[r,Object(a.jsx)(J,{})]})}function J(){var r=Object(F.a)({item:{id:"car",type:"car"}}),e=Object(f.a)(r,2)[1];return Object(a.jsx)("div",{className:"drag",ref:e,children:Object(a.jsx)("div",{className:"item car",draggable:!1})})}function P(r){var e=r.src,t=r.index,n=Object(F.a)({item:{id:t,type:"sign"}}),o=Object(f.a)(n,2)[1];return Object(a.jsx)(T.a,{className:"drag",ref:o,children:Object(a.jsx)("img",{src:e,className:"item sign",alt:e,draggable:!1})})}function A(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(z,{}),Object(a.jsx)(R,{})]})}d.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(i.a,{backend:s.a,children:Object(a.jsx)(A,{})})}),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.613ea844.chunk.js.map